<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>LifeHealth - Pagina Inicial</title>
    <meta name="description"
          content="particles.js is a lightweight JavaScript library for creating particles." />
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <link rel="stylesheet" media="screen" href="css/style.css" />
    <link rel="stylesheet" href="css/site.css" />
    <link rel="icon" href="assets/icon/mini.svg" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
          rel="stylesheet" />
          <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
</head>

<body>
    <div id="inicio">
        <div class="top-bar">
            <a href="login.html">
                <i class="fas fa-arrow-left"></i>
                Voltar para o login
            </a>
        </div>    
        <div class="content-register">
            <div class="cadastro-container">
                <div class="cadastro-text">
                    <h1>Cadastre-se</h1>
                    <p>Insira suas informações abaixo para criar sua conta e começar</p>
                    <form class="cadastro-form">
                        <!-- Passo 1 -->
                        <div class="input-wrapper">
                            <div class="inputs-step1" id="inputContainer">
                                <label for="nomeInstituicao">Nome da instituição</label>
                                <input type="text"
                                       id="input_nomeInstituicao"
                                       placeholder="Insira o nome da sua Instituição" />

                                <label for="nomeResponsavel">Nome do Responsável</label>
                                <input type="text"
                                       id="input_nomeResponsavel"
                                       placeholder="Insira o nome do Responsável" />

                                <label for="tipoInstituicao">Tipo de Instituição</label>
                                <select id="input_tipoInstituicao">
                                    <option value="" disabled selected>
                                        Selecione uma opção
                                    </option>
                                    <option value="Privada">Privada</option>
                                    <option value="Pública">Pública</option>
                                </select>
                            </div>

                            <!-- Passo 2 -->
                            <div id="hiddenInputs" class="inputs-step2 hidden">
                                <label for="endereco">CNPJ</label>
                                <input type="text"
                                       id="input_cnpj"
                                       placeholder="Insira o CNPJ da Insituição" />

                                <label for="telefone">CEP</label>
                                <input type="text"
                                       id="input_cep"
                                       placeholder="Insira o CEP da Instituição" />

                                <label for="estado">Estado de Residência</label>
                                <input type="estado"
                                       id="input_estado"
                                       placeholder="Insira seu estado"/>
                            </div>

                            <!-- Passo 3 -->
                            <div id="finalStep" class="inputs-step3 hidden">

                                <label for="email">Email de Contato</label>
                                <input type="email"
                                       id="input_email_cadastrar"
                                       placeholder="Insira seu email" />

                                <label for="campo1">Senha</label>
                                <input type="text"
                                       id="input_senha_cadastro"
                                       placeholder="Insira sua senha" />

                                <label for="campo2">Confirmar senha</label>
                                <input type="text"
                                       id="input_confirma_senha"
                                       placeholder="Insira sua senha novamente" />
                            </div>
                        </div>

                        <button type="button" class="btnContinuar" id="btnContinuar">
                            Continuar
                        </button>
                        <div class="dots-container">
                            <div class="dot" id="dot1"></div>
                            <div class="dot" id="dot2"></div>
                            <div class="dot" id="dot3"></div>
                        </div>
                    </form>
                </div>
                <div class="slideshow-container">
                    <div class="slideshow">
                        <img src="./assets/services/chart.svg" class="chartImage" alt="Chart Icon">
                        <div class="slide active"
                             style="
                  background-image: url('https://images.unsplash.com/photo-1562619425-c307bb83bc42?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
                ">
                            <div class="text-container">
                                <h1>Gráficos simples e fáceis de entender!</h1>
                                <p>
                                    Visualizações claras para monitorar e
                                    prever epidemias. Proteja sua comunidade hoje!
                                </p>
                            </div>
                        </div>

                        <div class="slide"
                             style="
                  background-image: url('https://images.unsplash.com/photo-1579267217516-b73084bd79a6?q=80&w=1887&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
                ">
                            <div class="text-container">
                                <h1>Gráficos precisos e detalhados!</h1>
                                <p>
                                    Dados apresentados de maneira eficiente
                                    para tomadas de decisão rápidas.
                                </p>
                            </div>
                        </div>

                        <div class="slide"
                             style="
                  background-image: url('https://images.unsplash.com/photo-1597773150796-e5c14ebecbf5?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
                ">
                            <div class="text-container">
                                <h1>Gráficos interativos!</h1>
                                <p>
                                    Interaja com os dados em tempo real e
                                    descubra insights valiosos.
                                </p>
                            </div>
                        </div>

                        <div class="slide"
                             style="
                  background-image: url('https://images.unsplash.com/photo-1598557470924-a2979fcdf017?q=80&w=1770&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D');
                ">
                            <div class="text-container">
                                <h1>Gráficos avançados e personalizados!</h1>
                                <p>
                                    Gráficos que se adaptam às suas necessidades
                                    com alta precisão e detalhes.
                                </p>
                            </div>
                        </div>
                        <!-- Dots fora dos slides individuais -->
                        <div class="custom-dots-container">
                            <span class="custom-dot"></span>
                            <span class="custom-dot"></span>
                            <span class="custom-dot"></span>
                            <span class="custom-dot"></span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="js/script.js"></script>
</body>
</html>
<script>
      function cadastrar() {
    var nomeInstituicaoVar = input_nomeInstituicao.value.trim();
    var nomeResponsavelVar = input_nomeResponsavel.value.trim(); 
    var tipoInstituicaoVar = input_tipoInstituicao.value.trim();
    var cnpjVar = input_cnpj.value.trim();
    var cepVar = input_cep.value.trim();
    var estadoVar = input_estado.value.trim();
    var emailVar = input_email_cadastrar.value.trim();
    var senhaVar = input_senha_cadastro.value.trim();
    var confirmacaoSenhaVar = input_confirma_senha.value.trim();

    // Verificar se todos os campos estão preenchidos
    if (!nomeInstituicaoVar || !nomeResponsavelVar || !tipoInstituicaoVar || !cnpjVar || 
        !cepVar || !estadoVar || !emailVar || !senhaVar || !confirmacaoSenhaVar) {
        alert("Por favor, preencha todos os campos.");
        return; 
    }

    // Verificar se as senhas coincidem
    if (senhaVar !== confirmacaoSenhaVar) {
        alert("As senhas não coincidem.");
        return;
    }

    // Verificação de duplicidade dentro da própria função cadastrar
    fetch("/usuarios/verificarCadastro", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
        },
        body: JSON.stringify({
            emailServer: emailVar,
            cnpjServer: cnpjVar,
        }),
    })
    .then(function (resposta) {
        if (!resposta.ok) {
            throw new Error("Erro ao verificar cadastro");
        }
        return resposta.json();
    })
    .then(function (resultado) {
        if (resultado.existe) {
            alert("E-mail ou CNPJ já cadastrados.");
            return; // Sai da função se o email ou CNPJ já existirem
        }

        // Prossegue com o cadastro se não houver duplicidade
        return fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                emailServer: emailVar,
                nomeInstituicaoServer: nomeInstituicaoVar,
                senhaServer: senhaVar,
                estadoServer: estadoVar,
                cepServer: cepVar,
                cnpjServer: cnpjVar,
                tipoInstituicaoServer: tipoInstituicaoVar,
                nomeResponsavelServer: nomeResponsavelVar
            }),
        });
    })
    .then(function (respostaCadastro) {
        if (respostaCadastro && respostaCadastro.ok) {
            alert("Cadastro realizado com sucesso! Redirecionando para tela de Login...");
            setTimeout(() => {
                window.location = "login.html";
            }, 2000);
        } else if (respostaCadastro) {
            respostaCadastro.text().then(texto => {
                alert(`Erro ao cadastrar: ${texto}`);
                console.log(`Erro ao cadastrar: ${texto}`);
            });
        }
    })
    .catch(function (erro) {
        console.log("Erro:", erro);
        alert("Ocorreu um erro ao tentar cadastrar. Tente novamente mais tarde.");
    });

    return false;
}


    document.addEventListener('DOMContentLoaded', function () {
        const urlParams = new URLSearchParams(window.location.search);
        const selectedOption = urlParams.get('selectedOption');
        const inputWrapper = document.getElementById('inputContainer');
        console.log(selectedOption);

        if (!inputWrapper) {
            console.error('Elemento com ID "inputContainer" não encontrado.');
            return;
        }

        
        if (selectedOption === 'option2') {

        inputWrapper.innerHTML = '';

            inputWrapper.innerHTML = `
                <div class="input-field">
                    <label for="input_nomeInstituicao">Nome da Farmácia</label>
                    <input type="text" id="input_nomeInstituicao" placeholder="Insira o nome da sua Farmácia">
                </div>
                <div class="input-field">   
                    <label for="nomeResponsavel">Nome do Responsável</label>
                    <input type="text" id="input_nomeResponsavel" placeholder="Insira o nome do Responsável">
                </div>
                <div class="input-field">
                    <label for="input_tipoInstituicao">Tipo de Farmácia</label>
                    <select id="input_tipoInstituicao">
                        <option value="" disabled selected>Selecione uma opção</option>
                        <option value="Local">Local</option>
                        <option value="Rede">Rede</option>
                    </select>
                </div>
            `;
        }

        document.querySelectorAll('.input-field').forEach(field => {
            field.style.marginBottom = '20px'; 
        });
    });
    

    function limparCampos() {
        document.getElementById("input_nomeInstituicao").value = "";
        document.getElementById("input_nomeResponsavel").value = "";
        document.getElementById("input_tipoInstituicao").value = "";
        document.getElementById("input_cnpj").value = "";
        document.getElementById("input_cep").value = "";
        document.getElementById("input_estado").value = "";
        document.getElementById("input_email_cadastrar").value = "";
        document.getElementById("input_senha_cadastro").value = "";
        document.getElementById("input_confirma_senha").value = "";
    }

    function atualizarBotao(step) {
    const actionButton = document.getElementById('actionButton');
    
    if (step === 1) {
        actionButton.innerText = "Próximo";
        actionButton.onclick = irParaStep2;
    } else if (step === 2) {
        actionButton.innerText = "Próximo";
        actionButton.onclick = irParaStep3;
    } else if (step === 3) {
        actionButton.innerText = "Finalizar";
        actionButton.onclick = cadastrar;
    }
}

function voltarParaStep1() {
    document.querySelector('.inputs-step1').classList.remove('hidden');
    document.querySelector('.inputs-step2').classList.add('hidden');
    document.querySelector('.inputs-step3').classList.add('hidden');

    document.getElementById('dot1').classList.add('active');
    document.getElementById('dot2').classList.remove('active');
    document.getElementById('dot3').classList.remove('active');

    atualizarBotao(1); // Configura o botão para Step 1
}

function irParaStep2() {
    document.querySelector('.inputs-step1').classList.add('hidden');
    document.querySelector('.inputs-step2').classList.remove('hidden');

    document.getElementById('dot1').classList.remove('active');
    document.getElementById('dot2').classList.add('active');

    atualizarBotao(2); // Configura o botão para Step 2
}

function irParaStep3() {
    document.querySelector('.inputs-step2').classList.add('hidden');
    document.querySelector('.inputs-step3').classList.remove('hidden');

    document.getElementById('dot2').classList.remove('active');
    document.getElementById('dot3').classList.add('active');

    atualizarBotao(3); // Configura o botão para Step 3
}
    window.addEventListener("pageshow", function (event) {
        if (event.persisted) { 
            location.reload(); 
            limparCampos(); 
            voltarParaStep1();
        }
    });


</script>